---
description: SlipUp project context â€” implemented features, run instructions, gating, known issues, PWA notes
globs: app.js,index.html,inside.html,landing.html,landing-inside.html,auth-inside.html,styles.css,manifest.json,sw.js,inside-auth.js
alwaysApply: false
---

# SlipUp Project Context

## Run locally
- **Server:** `npm run serve` or `npm start` (port 3333). **URL:** http://localhost:3333
- **PowerShell:** Use `;` to chain commands (e.g. `cd path; npm run serve`). `&&` not supported.
- **Bump version:** `node bump-version.js` (or `node bump-version.js 42`). Workflow runs on deploy.

## Project folder structure

```
mistake-tracker/
â”œâ”€â”€ index.html, inside.html, landing.html     # Main app pages
â”œâ”€â”€ landing-inside.html, auth-inside.html     # Inside landing & auth gate
â”œâ”€â”€ privacy.html, terms.html, refund.html    # Legal pages
â”œâ”€â”€ app.js, inside-auth.js                   # Main app logic (inside-auth for auth gate only)
â”œâ”€â”€ styles.css, sw.js                        # Styles & service worker
â”œâ”€â”€ config.js, config.example.js             # Supabase/config (config.js gitignored)
â”œâ”€â”€ manifest.json, icon.svg, icon-maskable.svg
â”œâ”€â”€ bump-version.js                          # Asset version bump (workflow runs on deploy)
â”œâ”€â”€ package.json                             # npm deps (serve)
â”œâ”€â”€ supabase-*.sql                           # Supabase migrations
â”œâ”€â”€ .github/workflows/main.yml               # Deploy workflow
â”œâ”€â”€ README.md, ARCHITECTURE.md, FLOW.md
â”œâ”€â”€ INCONSISTENCIES-REPORT.md, AUDIT-REPORT-2026.md
â””â”€â”€ .cursor/rules/project-context.mdc        # This file
```

## Structure

### index.html
- **Phase tabs:** Personal | Social | Inside (link to inside.html)
- **Personal view:** Micro-goal (Share intention) â†’ Add card â†’ Period tabs â†’ Stats â†’ Insights â†’ Premium â†’ Progress â†’ Trends â†’ Chart â†’ History (with Day/Week/Month tabs) â†’ Reflection
- **Social view (Share tab):** Share your stats first (social-block), period tabs, Share my result â†’ Recent shares (community-section) with btn-global-world ğŸŒ â†’ Community metrics (last 7 days). Link "Add a slip-up â†’" to add card.
- **Social â†’ World tab:** Global count chart â†’ Common words (insight-block--global-patterns) â†’ community-browse (limit chips + filters) â†’ Shared entries list. Link "See recent shares â†’" to Share tab.

### inside.html
- **Phase tabs:** Group | Shares (like Personal | Social)
- **Group:** Add moments, stats, intentions; Shares = group's shared moments feed
- **Shares view** â€” community-entries-section: global count chart, community-browse (Last 10 / All + filter groups), shared entries list. Heat/Shift/Support terminology. No Common words block (index-only).
- **Bias Check** â€” Inside uses "Why does this moment stand out?"; index uses "Why do you see this as a mistake?"

### landing.html, landing-inside.html
- Minimal top bar (brand only). No ğŸŒ, no + Add, no mood. CTA after Roadmap.
- **landing-inside** â€” CTA "Open SlipUp Inside" for groups.

### auth-inside.html
- Auth gate for SlipUp Inside (sign in / create account / magic link). Has PWA meta (apple-mobile-*, manifest). Does not register SW.

## Top bar

| Page | Left | Right |
|------|------|-------|
| index, inside | btn-settings \| top-bar-brand \| btn-theme-top | top-bar-slipups (ğŸŒ N) \| top-bar-add (+ Add) |
| landing, landing-inside | top-bar-brand only | â€” |
| privacy, terms, refund | top-bar-brand \| btn-theme | + Add (no slipups, no bell) |
| auth-inside | top-bar-brand | top-bar-home (Open app) |

- **Legal pages** â€” Use `btn-theme` (not btn-theme-top); title "Toggle theme" vs index/inside "How does this feel?"
- **top-bar-slipups** â€” index: opens Social â†’ world feed. inside: opens Shares. Refreshes on add (1200ms), phase switch.

## Implemented
- Add mistake/moment (max 19 chars), character count, type-colored (avoidable/fertile/observed)
- **Type pills** â€” avoidable / fertile / observed (Inside: heat/shift/support)
- **Bias Check** â€” When type=observed; modal 5 options. Copy differs index vs inside.
- **Micro-goal** â€” First on Personal; Share intention â†’ shared_intentions
- Period tabs (day/week/month), stats, streaks, exploration index
- **History** â€” index has Day/Week/Month tabs; inside has filters only
- **community-browse** â€” Restructured: limit chips (Last 10 / All) + filter-group (Type, Mood) with label-above-chips
- **Social share** â€” Share my result. Recent shares (contribution-first). Link to add card from metrics.
- **Global common words** â€” World tab only. Download full list gated.
- **Type colors** â€” --avoidable #c99a7a, --fertile #6ba88a, --observed #8b9bb8
- Theme (calm/focus/stressed/curious/tired)

## PWA / caching
- **manifest.json** â€” display: standalone, theme_color #14141a. start_url: index.html.
- **sw.js** â€” HTML fetch `cache: 'no-store'`. config.js never cached. inside-auth.js not in STATIC_ASSETS (cache-first on load).
- **config.js versioning** â€” index, inside, auth-inside use `?v=N`; landing, landing-inside do not.
- **Safe areas** â€” top-bar and .app use env(safe-area-inset-*).
- **bump-version.js** â€” HTML_FILES: index, inside, landing, landing-inside, auth-inside, privacy, terms, refund.

## Supabase
- Tables: shared_stats, shared_what_happened, shared_stats_inside. Optional: shared_chart_counts, streak_reflections, shared_intentions, todays_reflections, shared_entries_personal, shared_entries_inside, state_events.
- **supabase-inside-groups-admin.sql** â€” Run after supabase-inside-groups.sql. Adds: update_group_name, get_group_members, remove_member, leave_group, transfer_ownership, get_group_invites, cancel_group_invite. Group settings: edit name, member list (with Make creator / Remove), pending invites + cancel, leave group. Member skeleton + Try again on load error.
- **shared_stats breakdown** â€” Optional: supabase-shared-stats-breakdown.sql for avoidable_count, fertile_count, observed_count.
- Config: config.example.js â†’ config.js (local). Deploy: Secrets.

## Gated elements (PAID_ONLY_ELEMENT_IDS)
btn-export-csv, btn-export-reflections, btn-export-intentions, btn-export-feed, **btn-download-global-patterns**

(btn-export-json removed â€” not implemented.)

## Known issues / SlipUp style
- **CSS :has()** â€” Some linters flag it; acceptable.
- **Terminology** â€” index: slip-ups, mistakes. inside: moments. Bias Check copy matches.
- **Personal vs Inside** â€” add-sync-status, history-period-tabs, community-entries-last-updated on index only; intentional.
- **SlipUp style** â€” Calm, mirror-not-judge, user-intent, enjoyable. Contribution-first on Social. Sentence-case labels. Notice without pressure.

## Project docs
- **README.md** â€” Run, features, PWA, Supabase
- **ARCHITECTURE.md** â€” Design constraints
- **FLOW.md** â€” User flow, decision criteria
- **AUDIT-REPORT-2026.md** â€” Full audit summary
